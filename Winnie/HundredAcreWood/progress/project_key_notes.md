# 项目关键备注（Project Key Notes）

> 说明：此文档用于记录各个子项目的关键性备注、风险、决策点与后续任务，方便快速查看与协作。
>
> 路径：`docs/development/progress/project_key_notes.md`

---

## 📚 目录

- [multiAprog](#multiaprog)
- [aprog](#aprog)
- [tester](#tester)
- [mes](#mes)
- [新增 / 扩展说明](#新增--扩展说明)

---

## multiAprog

> 说明：此处仅记录关键性注意点与踩坑，便于快速查阅。

### 多语言支持与资源管理（来自 multiLanguage.md 的要点归纳）

- 项目架构要点

  - 主程序通过运行时加载资源 DLL 实现多语言（例如 `data/ACChinese.dll`、`data/ACSpanish.dll`、`data/ACJanpanese.dll`）。
  - 运行时通过 LoadLibrary + AfxSetResourceHandle 切换资源句柄来改变 UI 语言。
- 动态语言加载（实现要点）

  - 获取当前语言标识后使用 ::LoadLibrary("./data/XXX.dll") 加载对应资源 DLL，随后调用 AfxSetResourceHandle 设置资源句柄。
  - 切换语言时要注意释放/管理原有句柄以避免资源泄漏或不一致。
- 对话框控件的安全访问

  - 任何对话框控件的访问都必须先做空指针/句柄检查（GetDlgItem 返回 NULL 情况需处理）。
  - 推荐做法：在成员变量上使用 SubclassDlgItem 并用 GetSafeHwnd 检查是否已初始化，避免直接在不存在的控件上调用方法。
- 资源文件同步与发布流程（建议）

  1. 在主程序中修改资源（.rc）并更新 `resource.h`。
  2. 将修改同步到所有语言版本的资源工程（各语言的 .rc / resource.h）。
  3. 重新编译每个语言的资源 DLL（示例用 devenv 命令或通过 VS 工程构建）。
  4. 将生成的 DLL 部署到运行时 `data/` 目录并校验版本/时间戳。
- 常见问题与快速排查

  - 问题：GetDlgItem 返回 NULL 或控件访问崩溃。原因通常是资源 ID 在某些语言的 .rc 中缺失或不一致，或加载了错误/旧的 DLL。
  - 排查步骤：先用控件枚举（遍历子窗口、输出 ID 和类名）验证控件在运行时是否存在；核对所有语言的 `resource.h` 中的 ID 定义；重新编译并替换 DLL。
- 调试与验证技巧

  - 枚举对话框子控件并打印 ID/类名，快速找出缺失或 ID 冲突的控件。
  - 使用资源编辑器（或简单脚本）验证各语言 DLL 中是否包含期望的对话框/控件资源。
  - 在部署阶段比对 DLL 时间戳和版本，确保运行时加载的是最新编译产物。
- 项目与版本控制要点（补充）

  - 资源修改必须同步提交到所有语言分支/工程；任何资源 ID 变更都应在提交信息中说明并同步更新 `multiAprog.txt` 产物清单。
  - 打包时严格按照产物清单校对，避免遗漏语言 DLL、INI 或第三方依赖。

### 主/从模块区分

- 明确区分主模块（负责控制、调度、对外接口）与从模块（具体执行、硬件驱动、设备通讯）。
- 在工程结构、编译配置与运行时路径上保持严格分离，避免主/从模块文件混用。

### SN 烧录器具体注意点（写给后续维护/移植的人）

1. **工程复制注意事项**

   请在原有的 MFC 工程基础上进行项目复制，谨慎新建项目文件。

   > 直接新建工程常导致资源/配置不一致，引发兼容性问题。
   >
2. **软件类型区分**

   必须明确区分 `multiAprog` 与 `aprog` 两类软件（功能定位与部署路径不同）。

   编译配置、输出文件夹与运行时依赖要严格分离，避免混用 DLL 或 INI。
3. **产物清单管理**

   在 `multiAprog` 路径下的 `multiAprog.txt` 中列出所有产生的产物（例如 DLL、INI、配置文件、工具 EXE 等）。

   > 该清单用于发布/打包与现场排查，确保所有运行依赖可被追溯与复制。
   >
4. **验证流程**

   验证流程需同时覆盖 `aprog` 与 `multiaprog` 两个软件，二者联动才能完成完整功能验证。

   验证脚本或手册应明确对接顺序与数据交互格式。

   - 可以不生成ini文件
5. **SOP文档要求**

   软件需要编写SOP文档，具体可以参考 sn_ychuang

---

### 踩坑提示

- **工程移植风险**: 避免在新机器上直接打开原工程并做改名操作：MFC 的项目配置（.vcxproj/.sln）内部路径可能仍指向旧位置。
- **打包漏项检查**: 打包时务必比对 `multiAprog.txt` 中列举的每一项，常见漏项：第三方 DLL、地域/语言相关的资源文件、运行时 INI 配置。
- **环境一致性**: 本地调试与发布环境的 PATH/环境变量要一致，尤其是针对烧录器驱动与串口/USB 权限。
- **模块扩展原则**: 若需增加新模块，优先在复制的工程里做改动，并在 `multiAprog.txt` 追加说明（包括新增文件名与用途）。

---

## aprog

> 说明：此处仅记录关键性注意点与踩坑，便于快速查阅。

### 主/从模块区分

明确区分主模块（协议、总控）与从模块（设备驱动、接口实现）。

### 关键点与踩坑

- **接口兼容性**: 确保新版本与旧版本的接口兼容
- **版本管理**: 严格管理版本号，避免版本冲突
- **配置文件路径**: 注意配置文件的相对路径与绝对路径问题

### 踩坑提示

- **依赖管理**: 确保所有依赖库版本一致
- **内存管理**: 注意内存泄漏和野指针问题
- **线程安全**: 多线程环境下的数据竞争问题

---

## tester

> 说明：此处仅记录关键性注意点与踩坑，便于快速查阅。

### 主/从模块区分

测试体系中也需区分主控（测试管理、结果汇总）与被测从模块（设备固件、接口）。

### 关键点与踩坑

- **并发DUT管理**: 64个DUT同时测试时的资源竞争和数据隔离
- **日志采集一致性**: 确保所有DUT的日志格式统一，便于问题排查
- **测试环境隔离**: 防止不同DUT之间的测试互相影响
- **数据收集精度**: 温度、压力等数据的采样精度和频率控制

### 踩坑提示

- **线程安全**: GUI线程与测试线程的数据交互安全性
- **内存管理**: 长时间运行时的内存泄漏问题
- **错误处理**: 设备断线、测试异常时的恢复机制

---

## mes

> 说明：此处仅记录关键性注意点与踩坑，便于快速查阅。

### 主/从模块区分

MES 层作为主控/数据汇总层需与从模块（设备/测试客户端）保持清晰契约（API/消息格式）。

### 关键点与踩坑

- **数据一致性**: 确保数据在不同系统间的一致性和完整性
- **消息重试机制**: 在网络或服务异常时的重试策略
- **权限与接口限流**: API访问权限控制和限流机制
- **操作手册要求**: 操作手册一定要与客户强调清楚，接口文档明确各个测试项的内容，避免用户错误操作

### 踩坑提示

- **接口文档**: 确保接口文档的准确性和完整性
- **错误处理**: 完善的错误处理和日志记录机制
- **数据备份**: 关键数据的备份和恢复策略

---

## 新增 / 扩展说明

### 使用指南

- **新增项目节**: 复制上方任意一个项目区域，并把标题改为新项目名；在目录中追加链接。
- **建议字段**: 简介、当前状态、负责人、最近更新、关键问题、风险与依赖、下步行动、参考链接。
- **编辑规范**: 每次重要变更 → 在对应项目节追加一条 `YYYY-MM-DD — 变更摘要`，并在 git commit message 中引用本文件路径以便审计。

---

## 📅 文档信息

- **文件生成于**: 2025-08-20
- **最后更新**: 2025-08-25
- **文档版本**: v1.1
