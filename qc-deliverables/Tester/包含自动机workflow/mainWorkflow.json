{
  "id": "main_workflow_v1",
  "name": "主线程工作流",
  "description": "主线程执行的公共操作，包括HandlerDevice初始化和任务加载",
  "version": "1.0.0",
  "steps": [
    {
      "id": "step_set_version",
      "name": "设置协议版本",
      "type": "DeviceCommand",
      "config": {
        "deviceId": "handler_001",
        "command": "telldevcommversion",
        "params": {
          "version": 2
        }
      },
      "onError": "abort"
    },
    {
      "id": "delay_after_version",
      "name": "等待协议版本设置完成",
      "type": "Delay",
      "config": {
        "durationMs": 2000
      }
    },
    {
      "id": "step_start_site_threads",
      "name": "启动站点测试线程",
      "type": "StartSiteThreads",
      "config": {
        "siteIds": [
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8
        ],
        "workflowConfig": {
          "testStage": "${testStage}",
          "workflows": {
            "calibration": {
              "zone1": "calibration_zone1Workflow.json",
              "zone2": "calibration_zone2Workflow.json",
              "zone3": "calibration_zone3Workflow.json",
              "zone4": "calibration_zone4Workflow.json"
            },
            "error_test": {
              "zone1": "error_test_zone1Workflow.json",
              "zone2": "error_test_zone2Workflow.json",
              "zone3": "error_test_zone3Workflow.json",
              "zone4": "error_test_zone4Workflow.json"
            }
          },
          "siteZoneMapping": {
            "1": "zone1",
            "2": "zone1",
            "3": "zone2",
            "4": "zone2",
            "5": "zone3",
            "6": "zone3",
            "7": "zone4",
            "8": "zone4"
          }
        }
      },
      "onError": "abort"
    },
    {
      "id": "delay_after_start_threads",
      "name": "等待站点线程启动完成",
      "type": "Delay",
      "config": {
        "durationMs": 1000
      }
    },
    {
      "id": "step_set_site_status",
      "name": "设置站点状态",
      "type": "DeviceCommand",
      "config": {
        "deviceId": "handler_001",
        "command": "telldevready",
        "params": {
          "readyInfo": {
            "SiteCnt": 8,
            "SKTCnt": 8,
            "DeviceType": "StdMes",
            "Version": "1.0",
            "SiteEnable": [
              true,
              true,
              true,
              true,
              true,
              true,
              true,
              true
            ]
          }
        }
      },
      "onError": "abort"
    },
    {
      "id": "delay_after_site_status",
      "name": "等待站点状态设置完成",
      "type": "Delay",
      "config": {
        "durationMs": 2000
      }
    },
    {
      "id": "step_load_task",
      "name": "加载任务",
      "type": "DeviceCommand",
      "config": {
        "deviceId": "handler_001",
        "command": "loadtask",
        "params": {
          "taskData": "3,${effective_chipNum},${all_taskName},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"
        }
      },
      "onError": "abort"
    },
    {
      "id": "delay_after_load_task",
      "name": "等待任务加载完成",
      "type": "Delay",
      "config": {
        "durationMs": 2000
      }
    },
    {
      "id": "step_wait_for_zone_workflows",
      "name": "等待温区工作流完成",
      "type": "MainWorkflowWaitZoneComplete",
      "config": {
        "deviceId": "handler_001",
        "timeout": 0,
        "wait_for_signal": "zoneWorkflowComplete"
      },
      "onError": "abort"
    },
    {
      "id": "delay_after_load_task",
      "name": "等待任务加载完成",
      "type": "Delay",
      "config": {
        "durationMs": 2000
      }
    },
    {
      "id": "step_get_final_results",
      "name": "获取最终测试结果",
      "type": "DeviceCommand",
      "config": {
        "deviceId": "handler_001",
        "command": "getlotdata"
      },
      "onError": "continue"
    },
    {
      "id": "delay_final_cleanup",
      "name": "最终清理延时",
      "type": "Delay",
      "config": {
        "durationMs": 3000
      }
    }
  ]
}