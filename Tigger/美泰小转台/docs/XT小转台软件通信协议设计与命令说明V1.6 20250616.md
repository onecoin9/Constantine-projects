由于当前平台限制，我无法直接生成文件并提供下载，但我可以为你将上传的文档内容完整还原为 `.md` 格式（Markdown），并去除页头和页尾的内容。以下是完整的 `.md` 文档内容：

---

# XT小转台软件通信协议设计与命令说明

## 引言
本档案用于对XT小转台软件的通信协议命令设计与命令进行说明。

### 适用对象
- 技术支持工程师  
- 维护工程师  

## 版本记录
| 文档版本 | 文档编者 | 发布日期  | 修改说明                                                     |
| -------- | -------- | --------- | ------------------------------------------------------------ |
| 1.0      | 夏冬辉   | 2025/5/19 | 第一版                                                       |
| 1.1      | 夏冬辉   | 2025/5/26 | 1. 增加电压电流 <br> 2. 增加主板序列号                       |
| 1.2      | 夏冬辉   | 2025/6/04 | 增加故障状态数据                                             |
| 1.3      | 夏冬辉   | 2025/6/07 | 1. 修改采样数据上报格式 <br> 2. 增加电压故障查询指令 <br> 3. 增加电源开启指令 <br> 4. 增加参数设置指令 <br> 5. 增加寄存器读写指令 |
| 1.4      | 夏冬辉   | 2025/6/08 | 1. 删除组包数据 <br> 2. 增加同时读写全部DUT使能              |
| 1.5      | 夏冬辉   | 2025/6/16 | 1. 修复数据长度错误 <br> 2. 增加芯片类型配置 <br> 3. 数据增加芯片类型标识 |

## 类型约定
| 类型    | 占用字节数 | 说明                                                        |
| ------- | ---------- | ----------------------------------------------------------- |
| Uint8   | 1          | 无符号 1字节                                                |
| Int8    | 1          | 有符号 1字节                                                |
| Uint16  | 2          | 无符号 2字节                                                |
| Int16   | 2          | 有符号 2字节                                                |
| Uint32  | 4          | 无符号 4字节                                                |
| Int32   | 4          | 有符号 4字节                                                |
| Uint64  | 8          | 无符号 8字节                                                |
| Int64   | 8          | 有符号 8字节                                                |
| String  | 字符串     | 以 `\0` 结尾的字符串，UTF8编码                              |
| AString | 2 + 字符串 | 前面2个字节表示字符串长度，字符串部分为实际内容，以`\0`结尾 |

**多字节非字符串存放时都按照小端方式存放**。类型后面如果带 `*` 表示指定该类型的地址空间，能用的长度 >= 1 个类型单位。

### AString说明：
前面2个字节为 `Uint16` 表示后面字符串的长度，字符串部分为实际内容，以 `\0` 结尾。例如 "Hello"，实际占有字节数为 `2+5+1=8` 个。以上多个字节按照小端方式存放。

## 通信说明

### 协议说明
测试软件与 XT 小转台主板的通信采用 RS422 协议。

- **测试软件部署在 PC 端**
- **XT 小转台主板有 1 个，SOCKET 板 4 个，SOCKET 8 个**

#### RS422 端口配置
- 波特率：1382400
- 数据位：8
- 停止位：1
- 奇偶校验位：无

#### 测试软件和 XT 小转台主板的协议
采用字符串的方式通信，
- 主机：温控软件
- 从机：XT 小转台主板

### 通信格式
每个通信包都包含如下字段：

| 成员        | 说明         | 类型   | 占用字节数 | 备注                                            |
| ----------- | ------------ | ------ | ---------- | ----------------------------------------------- |
| CmdFlag     | 命令标志     | Uint32 | 4          | `0x58544B5A`（XT控制“XTKZ”4个汉字的首字母大写） |
| CmdID       | 命令码       | Uint16 | 2          | 不同的命令码有不同的功能                        |
| CmdDataSize | 命令数据长度 | Uint16 | 2          | 不同的命令码有不同的命令数据长度                |
| CmdData     | 命令数据     | Uint8  | N          | 不同的命令会有不同的命令数据                    |
| CRC8        | 校验值       | Uint8  | 1          | 前面所有字节的累加和，取1个字节                 |

整个包长度为 `8 + CmdDataSize + 1`；
校验值算法：
```c
uint8_t Crc(uint8_t* data, uint16_t size)
{
    uint8_t crc = 0;
    uint16_t i;
    for(i = 0; i < size; i++)
        crc += data[i];
    return crc;
}
```

## 通信包结构体说明

### 命令描述

#### 1.1 启停指令（CmdId=0x01）
- **功能**：开启或者关闭小转台主板
- **发送时机点说明**：定时发送，板子进行测试时发送开启，板子停止测试时发送停止

##### 主机发送数据：
- **CmdID**：0x01
- **CmdDataSize**：7 字节
- **CmdData**：
| 成员       | 说明       | 类型   | 大小 | 备注                                            |
| ---------- | ---------- | ------ | ---- | ----------------------------------------------- |
| State      | 温控板状态 | Uint8  | 1    | `01` 为开启，`00` 为停止                        |
| Dut_active | DUT 控制位 | Uint16 | 2    | bit0-7 表示 DUT1-8，Bit15 表示 313 标准标定数据 |
| Time       | 时间戳     | Uint32 | 4    | 启动时间                                        |

#### 1.2 测试板反馈数据（CmdId=0x8001）
- **功能**：测试板所有 DUT 及外挂陀螺仪的测试数据
- **发送时机点说明**：开启测试后，定时发送，主动上报

##### 测试板发送数据：
- **CmdID**：0x8001
- **CmdDataSize**：1+4+4+2+1 + 8*30 + 32 = 284
- **CmdData**：
| 成员             | 说明                 | 类型   | 大小 | 备注                                                         |
| ---------------- | -------------------- | ------ | ---- | ------------------------------------------------------------ |
| Test state       | 测试状态             | Uint8  | 1    | `01` 为测试中，`00` 为停止，`02` 为故障                      |
| SN               | 主板序列号           | Uint32 | 4    | 主板序列号或主板地址                                         |
| Time             | 时间序列             | Uint32 | 4    | 上报时间序列                                                 |
| Dut_active       | DUT 数据使能         | Uint16 | 2    | bit0-7 表示 DUT1-8，Bit15 表示 313 标准标定数据；`0`：无效，`1`：有效 |
| ChipIndex        | 待测芯片类型序号     | Uint8  | 1    | `1` 表示 A300，`2` 表示 G300，`3` 表示 270...                |
| Gyro_x           | X轴陀螺数据          | Uint32 | 4    | DUT1采样数据                                                 |
| Gyro_y           | Y轴陀螺数据          | Uint32 | 4    |                                                              |
| Gyro_z           | Z轴陀螺数据          | Uint32 | 4    |                                                              |
| Gyro_acc_x       | X轴加表数据          | Uint32 | 4    |                                                              |
| Gyro_acc_y       | Y轴加表数据          | Uint32 | 4    |                                                              |
| Gyro_acc_z       | Z轴加表数据          | Uint32 | 4    |                                                              |
| Gyro_mix         | 正交耦合数据         | Uint32 | 4    |                                                              |
| Gyro_temperature | 温度数据             | Uint16 | 2    |                                                              |
| ... (重复7次)    | 以上数据 * 7         | ...    | ...  | DUT2-DUT8                                                    |
| Gyro_x           | X轴陀螺数据          | Uint32 | 4    | 外挂陀螺仪数据                                               |
| Gyro_y           | Y轴陀螺数据          | Uint32 | 4    |                                                              |
| Gyro_z           | Z轴陀螺数据          | Uint32 | 4    |                                                              |
| Gyro_acc_x       | X轴加表数据          | Uint32 | 4    |                                                              |
| Gyro_acc_y       | Y轴加表数据          | Uint32 | 4    |                                                              |
| Gyro_acc_z       | Z轴加表数据          | Uint32 | 4    |                                                              |
| Gyro_mix         | 正交耦合数据         | Uint32 | 4    |                                                              |
| Gyro_temperature | 温度数据             | Uint16 | 2    |                                                              |
| Gyro_counter     | 计数器               | Uint16 | 2    | 外挂陀螺仪数据计数器 ms                                      |

#### 1.3 DUT电源控制（CmdId=0x02）
- **功能**：开启或者关闭小转台主板 DUT 电源
- **发送时机点说明**：事件发送，DUT 进行测试或标定时先发送开启电源，DUT 停止测试或停止标定时发送关闭电源

##### 主机发送数据：
- **CmdID**：0x02
- **CmdDataSize**：3 字节
- **CmdData**：
| 成员             | 说明           | 类型   | 大小 | 备注                                                         |
| ---------------- | -------------- | ------ | ---- | ------------------------------------------------------------ |
| State            | 温控板状态     | Uint8  | 1    | `01` 为开启，`00` 为停止                                     |
| Dut_Power_enable | DUT 电源控制位 | Uint16 | 2    | bit0-7 表示 DUT1-8，Bit15 表示 313 电源控制；`0`:忽略，`1`:使能 |

##### 测试板反馈数据：
- **CmdID**：0x8002
- **CmdDataSize**：7 字节
- **CmdData**：
| 成员            | 说明             | 类型   | 大小 | 备注                                                         |
| --------------- | ---------------- | ------ | ---- | ------------------------------------------------------------ |
| SN              | 主板序列号       | Uint32 | 4    | 主板序列号或主板地址                                         |
| State           | 控制状态反馈     | Uint8  | 1    | `0`:失败，`1`:成功                                           |
| Dut_Power_state | 电源控制状态反馈 | Uint16 | 2    | bit0-7 表示 DUT1-8，Bit15 表示 313 电源状态；`0`:关闭，`1`:开启 |

#### 1.4 DUT电压电流查询（CmdId=0x03）
- **功能**：查询 DUT 供电电压电流
- **发送时机点说明**：事件发送，需要查询时下发

##### 主机发送数据：
- **CmdID**：0x03
- **CmdDataSize**：0 字节
- **CmdData**：无

##### 测试板反馈数据：
- **CmdID**：0x8003
- **CmdDataSize**：72 字节
- **CmdData**：
| 成员                        | 说明                        | 类型   | 大小 | 备注                   |
| --------------------------- | --------------------------- | ------ | ---- | ---------------------- |
| SN                          | 主板序列号                  | Uint32 | 4    | 主板序列号或主板地址   |
| 主板供电电压                | 电压                        | Uint16 | 2    | 单位 mV                |
| 主板供电电流                | 电流                        | Uint16 | 2    | 单位 mA                |
| DUT1 5V供电电压             | 电压                        | Uint16 | 2    | 单位 mV                |
| DUT1 5V供电电流             | 电流                        | Uint16 | 2    | 单位 mA                |
| DUT1 3.3V供电电压           | 电压                        | Uint16 | 2    | 单位 mV                |
| DUT1 3.3V供电电流           | 电流                        | Uint16 | 2    | 单位 mA                |
| 依次 DUT1-DUT7 电压电流数据 | 依次 DUT1-DUT7 电压电流数据 | Uint16 | 7*8  | 每个 DUT 有 8 个数据项 |

#### 1.5 测试板故障状态查询（CmdId=0x04）
- **功能**：查询测试板故障状态
- **发送时机点说明**：事件发送，需要查询时下发

##### 主机发送数据：
- **CmdID**：0x04
- **CmdDataSize**：0 字节
- **CmdData**：无

##### 测试板反馈数据：
- **CmdID**：0x8004
- **CmdDataSize**：8 字节
- **CmdData**：
| 成员        | 说明       | 类型   | 大小 | 备注                                                        |
| ----------- | ---------- | ------ | ---- | ----------------------------------------------------------- |
| SN          | 主板序列号 | Uint32 | 4    | 主板序列号或主板地址                                        |
| Fault state | 故障位     | Uint32 | 4    | Bit0-Bit31 代表不同故障，`0`:无故障，`1`:有故障（定义保留） |

#### 1.6 测试标定指令（CmdId=0x05）
- **功能**：测试标定 DUT
- **发送时机点说明**：事件发送，需要标定时下发

##### 主机发送数据：
- **CmdID**：0x05
- **CmdDataSize**：2 + n 字节（n 为实际指令长度）
- **CmdData**：
| 成员    | 说明       | 类型  | 大小   | 备注                                                         |
| ------- | ---------- | ----- | ------ | ------------------------------------------------------------ |
| Dut_sel | DUT 选择位 | Uint8 | 1      | bit0-7 表示 DUT1-8；`0`:不标定，`1`:标定，`0xFF` 表示全部同时标定 |
| length  | 指令长度   | Uint8 | 1      |                                                              |
| command | 指令       | Uint8 | length |                                                              |

##### 测试板反馈数据：
- **CmdID**：0x8005
- **CmdDataSize**：5 + n 字节（n 为实际写入指令长度）
- **CmdData**：
| 成员    | 说明         | 类型   | 大小 | 备注                 |
| ------- | ------------ | ------ | ---- | -------------------- |
| SN      | 主板序列号   | Uint32 | 4    | 主板序列号或主板地址 |
| State   | 标定状态反馈 | Uint8  | 1    | `0`:失败，`1`:成功   |
| Command | 写入指令反馈 | Uint8  | n    |                      |

#### 1.7 寄存器写入指令（CmdId=0x06）
- **功能**：寄存器写入指令
- **发送时机点说明**：事件发送，需要写寄存器时下发

##### 主机发送数据：
- **CmdID**：0x06
- **CmdDataSize**：2 + n 字节（n 为实际数据长度）
- **CmdData**：
| 成员     | 说明       | 类型  | 大小 | 备注                                                         |
| -------- | ---------- | ----- | ---- | ------------------------------------------------------------ |
| Dut_sel  | DUT 使能位 | Uint8 | 1    | bit0-7 表示 DUT1-8；`0`:不写入，`1`:写入，`0xFF` 表示同时写入 |
| Reg_addr | 寄存器地址 | Uint8 | 1    |                                                              |
| length   | 数据长度   | Uint8 | 1    |                                                              |
| value    | 写入数据   | Uint8 | n    |                                                              |

##### 测试板反馈数据：
- **CmdID**：0x8006
- **CmdDataSize**：5 + 3 + M*n 字节（n 为实际数据长度，M（1-8）为使能的 DUT 个数）
- **CmdData**：
| 成员     | 说明               | 类型   | 大小 | 备注                                       |
| -------- | ------------------ | ------ | ---- | ------------------------------------------ |
| SN       | 主板序列号         | Uint32 | 4    | 主板序列号或主板地址                       |
| State    | 写入状态反馈       | Uint8  | 1    | `0`:失败，`1`:成功                         |
| Dut_sel  | DUT反馈使能位      | Uint8  | 1    | bit0-7 表示 DUT1-8；`0`:无反馈，`1`:有反馈 |
| Reg_addr | 写入寄存器地址     | Uint8  | 1    |                                            |
| length   | 数据长度           | Uint8  | 1    |                                            |
| Value_1  | 写入寄存器读取数据 | Uint8  | n    | 第一个使能的 DUT 反馈数据                  |
| ...      | ...                | ...    | ...  | ...                                        |
| Value_M  | 写入寄存器读取数据 | Uint8  | n    | 最后一个使能的 DUT 反馈数据                |

#### 1.8 寄存器查询指令（CmdId=0x07）
- **功能**：寄存器查询指令
- **发送时机点说明**：事件发送，需要查询寄存器时下发

##### 主机发送数据：
- **CmdID**：0x07
- **CmdDataSize**：3 字节
- **CmdData**：
| 成员     | 说明       | 类型  | 大小 | 备注                                                         |
| -------- | ---------- | ----- | ---- | ------------------------------------------------------------ |
| Dut_sel  | DUT 选择位 | Uint8 | 1    | bit0-7 表示 DUT1-8；`0`:不查询，`1`:查询，`0xFF` 表示同时查询 |
| Reg_addr | 寄存器地址 | Uint8 | 1    |                                                              |
| length   | 数据长度   | Uint8 | 1    |                                                              |

##### 测试板反馈数据：
- **CmdID**：0x8007
- **CmdDataSize**：4 + 4 + M*n 字节（n 为实际数据长度，M（1-8）为使能的 DUT 个数）
- **CmdData**：
| 成员     | 说明             | 类型   | 大小 | 备注                                       |
| -------- | ---------------- | ------ | ---- | ------------------------------------------ |
| SN       | 主板序列号       | Uint32 | 4    | 主板序列号或主板地址                       |
| State    | 读取状态反馈     | Uint8  | 1    | `0`:失败，`1`:成功                         |
| Dut_sel  | DUT反馈使能位    | Uint8  | 1    | bit0-7 表示 DUT1-8；`0`:无反馈，`1`:有反馈 |
| Reg_addr | 被查询寄存器地址 | Uint8  | 1    |                                            |
| length   | 数据长度         | Uint8  | 1    |                                            |
| Value_1  | 寄存器读取数据   | Uint8  | n    | 第一个使能的 DUT 反馈数据                  |
| ...      | ...              | ...    | ...  | ...                                        |
| Value_M  | 寄存器读取数据   | Uint8  | n    | 最后一个使能的 DUT 反馈数据                |

#### 1.9 设置产品类型（CmdId=0x08）
- **功能**：设置待查芯片类型
- **发送时机点说明**：事件发送，需要标定时下发

##### 主机发送数据：
- **CmdID**：0x08
- **CmdDataSize**：1 字节
- **CmdData**：
| 成员      | 说明             | 类型  | 大小 | 备注                                          |
| --------- | ---------------- | ----- | ---- | --------------------------------------------- |
| ChipIndex | 待测芯片类型序号 | Uint8 | 1    | `1` 表示 A300，`2` 表示 G300，`3` 表示 270... |

##### 测试板反馈数据：
- **CmdID**：0x8008
- **CmdDataSize**：6 字节
- **CmdData**：
| 成员      | 说明                 | 类型   | 大小 | 备注                                          |
| --------- | -------------------- | ------ | ---- | --------------------------------------------- |
| SN        | 主板序列号           | Uint32 | 4    | 主板序列号或主板地址                          |
| State     | 状态反馈             | Uint8  | 1    | `0`:失败，`1`:成功                            |
| ChipIndex | 待测芯片类型序号反馈 | Uint8  | 1    | `1` 表示 A300，`2` 表示 G300，`3` 表示 270... |

---

如果你需要 `.html` 或其他格式，请告诉我，我可以为你转换！